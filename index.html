<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Genesis World Engine</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Instrument+Serif:ital@0;1&family=Inter:wght@400;500&display=swap" rel="stylesheet">
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          fontFamily: {
            serif: ['"Instrument Serif"', 'serif'],
            sans: ['"Inter"', 'system-ui', '-apple-system', 'sans-serif'],
          },
          colors: {
            zinc: { 900: '#18181b', 950: '#09090b' },
            monitor: { beige: '#d6d5c9', dark: '#b8b7ab', light: '#e8e7df' }
          }
        }
      }
    }
  </script>
  <link rel="stylesheet" href="/src/style.css">
</head>
<body class="bg-zinc-950 text-zinc-100 font-serif antialiased selection:bg-orange-500/30 overflow-hidden relative">

  <!-- Environment: Desk & Room Background -->
  <div class="fixed inset-0 bg-gradient-to-b from-zinc-800 to-zinc-950 z-0"></div>

  <!-- Desk surface -->
  <div class="fixed bottom-0 w-full h-[25vh] bg-[#1a1a1c] border-t border-black shadow-[inset_0_40px_80px_rgba(0,0,0,0.8)] z-0 flex items-start pl-[280px] lg:pl-[340px]">
    <div class="w-full flex justify-center mt-8">
      <div class="w-[600px] h-[40px] bg-black/60 blur-[20px] rounded-[100%]"></div>
    </div>
  </div>

  <!-- Ambient monitor glow -->
  <div class="fixed inset-0 z-0 pointer-events-none flex pl-[280px] lg:pl-[340px]">
    <div class="w-full h-full relative">
      <div id="ambient-glow" class="absolute bottom-[20vh] left-1/2 -translate-x-1/2 w-[600px] h-[300px] bg-orange-900/10 blur-[120px] transition-opacity duration-500 opacity-0"></div>
    </div>
  </div>

  <!-- Main layout -->
  <div id="app" class="state-off relative z-10 w-full h-screen flex">

    <!-- Left Panel: Chat Sidebar -->
    <aside class="w-[280px] lg:w-[340px] h-full flex flex-col border-r border-white/10 bg-[#1c1c20] flex-shrink-0 relative z-20 shadow-[4px_0_24px_rgba(0,0,0,0.5)]">

      <!-- Header -->
      <header class="p-4 md:p-5 border-b border-white/10 flex items-center justify-between shrink-0">
        <div class="flex items-center gap-3">
          <div class="w-7 h-7 rounded-full border border-white/20 flex items-center justify-center bg-white/5">
            <iconify-icon icon="lucide:globe" class="text-zinc-400 text-sm"></iconify-icon>
          </div>
          <div>
            <h1 class="text-lg tracking-wide">Genesis</h1>
            <div class="text-[10px] text-zinc-500 tracking-widest uppercase mt-0.5 flex items-center gap-2">
              <span id="engine-status-dot" class="w-1.5 h-1.5 rounded-full bg-red-500"></span>
              <span id="engine-status-text">Engine Offline</span>
            </div>
          </div>
        </div>
        <button type="button" id="btn-narrator" class="text-zinc-500 hover:text-zinc-300 transition-colors p-1.5 rounded-md border border-white/10 bg-white/5 hover:bg-white/10" title="Toggle narrator voice">
          <iconify-icon icon="lucide:volume-off" class="text-sm" id="narrator-icon"></iconify-icon>
        </button>
      </header>

      <!-- Chat History -->
      <main id="chat-history" class="flex-1 overflow-y-auto p-4 md:p-5 flex flex-col gap-6 relative font-sans scroll-smooth">
        <div class="sticky top-0 w-full h-6 bg-gradient-to-b from-[#1c1c20] to-transparent pointer-events-none -mt-5 mb-2 z-10"></div>

        <!-- Initial system message -->
        <div class="flex flex-col gap-1">
          <div class="text-zinc-500 text-xs italic">System ready. Power on to begin.</div>
        </div>

        <div class="h-2"></div>
      </main>

      <!-- New World button (visible only during streaming) -->
      <div id="new-world-bar" class="px-4 pt-3 pb-1 shrink-0 bg-[#1c1c20] hidden">
        <button type="button" id="btn-new-world" class="w-full flex items-center justify-center gap-2 py-2 rounded-md border border-white/10 bg-white/5 hover:bg-white/10 text-zinc-300 hover:text-white transition-all text-xs font-sans tracking-wide uppercase">
          <iconify-icon icon="lucide:rotate-ccw" class="text-[11px]"></iconify-icon>
          New World
        </button>
      </div>

      <!-- Input Area -->
      <footer class="p-4 shrink-0 bg-[#1c1c20]">
        <form id="prompt-form" class="relative group">
          <div class="absolute -inset-0.5 bg-gradient-to-r from-zinc-800 to-zinc-700 rounded-lg blur opacity-25 group-hover:opacity-40 transition duration-500"></div>
          <div class="relative flex flex-col bg-[#232328] border border-white/15 rounded-lg p-1.5 transition-colors focus-within:border-white/30">
            <!-- Voice status HUD -->
            <div id="voice-status" class="voice-status hidden">
              <span class="status-dot"></span>
              <span id="voice-status-text">LISTENING</span>
            </div>
            <!-- Voice waveform visualizer -->
            <canvas id="voice-waveform" class="waveform-canvas hidden" width="400" height="32"></canvas>
            <!-- Voice transcript preview -->
            <div id="voice-transcript" class="voice-transcript hidden font-sans"></div>
            <textarea
              id="prompt-input"
              placeholder="Describe a world…"
              class="w-full bg-transparent text-sm md:text-base p-3 text-zinc-200 placeholder:text-zinc-500 outline-none resize-none min-h-[70px] font-sans disabled:opacity-30 disabled:cursor-not-allowed"
              spellcheck="false"
              disabled
            ></textarea>
            <!-- Image preview -->
            <div id="image-preview" class="hidden px-3 pb-2">
              <div class="relative inline-block">
                <img id="image-thumb" class="h-12 rounded border border-white/10" />
                <button type="button" id="image-remove" class="absolute -top-1.5 -right-1.5 w-4 h-4 bg-zinc-700 rounded-full flex items-center justify-center hover:bg-zinc-500 transition-colors">
                  <iconify-icon icon="lucide:x" class="text-[8px] text-white"></iconify-icon>
                </button>
              </div>
            </div>
            <div class="flex items-center justify-between px-3 pb-1.5">
              <div class="flex items-center gap-2">
                <input type="file" id="image-input" accept="image/jpeg,image/png,image/webp,image/gif,image/bmp,image/heic,image/heif,image/avif" class="hidden" />
                <button type="button" id="btn-attach" class="text-zinc-500 hover:text-zinc-300 transition-colors p-1 disabled:opacity-30 disabled:cursor-not-allowed" disabled>
                  <iconify-icon icon="lucide:image-plus" class="text-sm"></iconify-icon>
                </button>
                <button type="button" id="btn-mic" class="text-zinc-500 hover:text-zinc-300 transition-colors p-1 rounded-md border border-transparent disabled:opacity-30 disabled:cursor-not-allowed flex items-center gap-1" disabled title="Voice input">
                  <iconify-icon icon="lucide:mic" class="text-sm" id="mic-icon"></iconify-icon>
                  <span id="mic-label" class="mic-live-label hidden">MIC</span>
                </button>
              </div>
              <button type="submit" id="btn-execute" class="flex items-center gap-1.5 bg-white text-black px-3 py-1.5 rounded-md hover:bg-zinc-200 transition-colors disabled:opacity-30 disabled:cursor-not-allowed" disabled>
                <span class="text-sm font-serif">Send</span>
                <iconify-icon icon="lucide:arrow-up" class="text-sm"></iconify-icon>
              </button>
            </div>
          </div>
        </form>
      </footer>
    </aside>

    <!-- Right Panel: The Monitor -->
    <main class="flex-1 h-full flex flex-col items-center justify-center p-4 sm:p-8 perspective-[1500px] overflow-hidden relative z-10">

      <div class="flex flex-col items-center transform-gpu rotate-x-[1deg] translate-y-[-2vh] w-full max-w-[1000px]">

        <!-- Monitor Body -->
        <div class="relative z-20 w-full bg-monitor-beige rounded-[2rem] p-4 sm:p-6 md:p-8 pb-6 shadow-[inset_-6px_-6px_20px_rgba(0,0,0,0.25),inset_6px_6px_20px_rgba(255,255,255,0.9),0_40px_80px_rgba(0,0,0,0.8)] border border-white flex flex-col">

          <!-- Ventilation Grills -->
          <div class="absolute top-3 left-1/2 -translate-x-1/2 flex gap-3 opacity-60">
            <div class="w-16 h-1 bg-black/40 rounded-full shadow-[inset_0_1px_2px_rgba(0,0,0,0.5),0_1px_0_rgba(255,255,255,0.8)]"></div>
            <div class="w-16 h-1 bg-black/40 rounded-full shadow-[inset_0_1px_2px_rgba(0,0,0,0.5),0_1px_0_rgba(255,255,255,0.8)]"></div>
            <div class="w-16 h-1 bg-black/40 rounded-full shadow-[inset_0_1px_2px_rgba(0,0,0,0.5),0_1px_0_rgba(255,255,255,0.8)]"></div>
          </div>

          <!-- Inner Screen Bezel -->
          <div class="bg-[#111] p-3 sm:p-4 rounded-2xl shadow-[inset_0_0_30px_rgba(0,0,0,1),0_2px_4px_rgba(255,255,255,0.6)] flex flex-col w-full relative">
            <div class="absolute inset-0 border-2 border-white/5 rounded-2xl pointer-events-none"></div>

            <!-- CRT Screen -->
            <div id="crt-screen" class="relative w-full aspect-[16/9] bg-black rounded-xl overflow-hidden shadow-[inset_0_0_60px_rgba(0,0,0,0.9)] border border-white/10 transition-all duration-300">

              <!-- CRT Glass Overlays -->
              <div class="absolute inset-0 bg-[radial-gradient(ellipse_at_50%_0%,rgba(255,255,255,0.08)_0%,transparent_70%)] pointer-events-none z-40"></div>
              <div class="absolute inset-0 shadow-[inset_0_0_80px_rgba(0,0,0,0.8)] pointer-events-none z-40 mix-blend-multiply"></div>
              <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,transparent_60%,rgba(0,0,0,0.6)_100%)] pointer-events-none z-40"></div>

              <!-- Screen Content -->
              <div id="screen-content" class="absolute inset-0 z-10 transition-opacity duration-300 opacity-0">
                <section class="w-full h-full relative bg-black flex flex-col overflow-hidden">

                  <!-- Top HUD Bar -->
                  <div id="hud-bar" class="h-6 w-full bg-[#050505]/80 backdrop-blur-sm border-b border-white/10 flex items-center justify-between px-3 z-30 shrink-0 absolute top-0 left-0 opacity-0 transition-opacity duration-500">
                    <div class="flex items-center gap-2">
                      <div class="w-1.5 h-1.5 rounded-full bg-orange-500 shadow-[0_0_8px_rgba(249,115,22,1)]"></div>
                      <span class="text-[9px] text-zinc-200 tracking-[0.2em] uppercase font-sans">Live Feed // Odyssey-2</span>
                    </div>
                    <div class="flex items-center gap-4 text-[9px] text-white/80 tracking-[0.2em] uppercase font-sans">
                      <span>720p</span>
                      <span id="hud-fps" class="tabular-nums">FPS: --</span>
                      <span id="hud-duration" class="text-white tabular-nums">00:00</span>
                    </div>
                  </div>

                  <!-- Video + Overlays -->
                  <div class="relative w-full h-full">
                    <video id="world" autoplay playsinline muted class="absolute inset-0 w-full h-full object-cover opacity-0 transition-opacity duration-700"></video>
                    <div class="absolute inset-0 bg-gradient-to-t from-orange-950/40 via-transparent to-black/30 mix-blend-multiply pointer-events-none"></div>

                    <!-- HUD Corner Brackets -->
                    <div class="absolute inset-0 pointer-events-none p-5 md:p-8 flex flex-col justify-between z-30 pt-10 opacity-0 transition-opacity duration-500" id="hud-overlay">
                      <div class="flex justify-between items-start w-full">
                        <div class="w-6 h-6 border-t border-l border-white/40 opacity-70"></div>
                        <div class="w-6 h-6 border-t border-r border-white/40 opacity-70"></div>
                      </div>
                      <div class="flex justify-between items-end w-full">
                        <div class="w-6 h-6 border-b border-l border-white/40 opacity-70"></div>
                        <div class="w-6 h-6 border-b border-r border-white/40 opacity-70"></div>
                      </div>
                    </div>
                  </div>
                </section>
              </div>

              <!-- Boot screen (visible during connecting) -->
              <div id="screen-boot" class="absolute inset-0 z-[25] flex flex-col items-center justify-center opacity-0 transition-opacity duration-500 bg-black">
                <div id="boot-terminal" class="w-full max-w-[400px] px-8 font-mono text-left">
                  <div id="boot-lines" class="flex flex-col gap-1.5 text-[11px] text-amber-400/80 tracking-wide"></div>
                </div>
              </div>

              <!-- Idle screen — retro CRT terminal (visible when connected, no stream yet) -->
              <div id="screen-idle" class="absolute inset-0 z-20 flex flex-col items-center justify-center opacity-0 transition-opacity duration-700 bg-black">
                <!-- Subtle grid overlay -->
                <div class="absolute inset-0 opacity-[0.04]" style="background-image: linear-gradient(rgba(245,158,11,0.3) 1px, transparent 1px), linear-gradient(90deg, rgba(245,158,11,0.3) 1px, transparent 1px); background-size: 40px 40px;"></div>
                <!-- Radial vignette -->
                <div class="absolute inset-0 bg-[radial-gradient(circle_at_50%_50%,transparent_30%,rgba(0,0,0,0.7)_100%)]"></div>
                <!-- Content -->
                <div class="relative flex flex-col items-center gap-8">
                  <!-- Pulsing reticle -->
                  <div class="w-16 h-16 border border-amber-500/30 rounded-full flex items-center justify-center animate-pulse">
                    <div class="w-8 h-8 border border-amber-500/50 rounded-full flex items-center justify-center">
                      <div class="w-2 h-2 bg-amber-500/80 rounded-full shadow-[0_0_12px_rgba(245,158,11,0.6)]"></div>
                    </div>
                  </div>
                  <div class="flex flex-col items-center gap-2">
                    <div class="text-amber-500/80 text-xs font-sans font-medium tracking-[0.3em] uppercase">Awaiting Input</div>
                    <div class="text-amber-500/30 text-[9px] font-sans tracking-[0.2em] uppercase">Reality Engine Ready</div>
                  </div>
                  <!-- Separator -->
                  <div class="w-40 h-px bg-gradient-to-r from-transparent via-amber-500/30 to-transparent"></div>
                  <!-- Example prompts -->
                  <div id="example-prompts" class="flex flex-col items-center gap-3">
                    <div class="text-amber-500/25 text-[9px] font-sans tracking-[0.2em] uppercase">Try saying or typing</div>
                    <button id="example-prompt-btn" class="text-amber-400/50 hover:text-amber-400/90 text-sm font-serif italic transition-all duration-500 cursor-pointer max-w-[300px] text-center leading-relaxed hover:drop-shadow-[0_0_8px_rgba(245,158,11,0.3)]"></button>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Monitor Controls -->
          <div class="flex items-center justify-between pt-5 px-6 sm:px-10 shrink-0 relative">
            <div class="flex items-baseline gap-2">
              <span class="font-sans font-black tracking-[0.15em] text-monitor-dark text-xl drop-shadow-[0_1px_1px_rgba(255,255,255,0.9)]">GENESIS</span>
              <span class="font-sans font-bold tracking-widest text-[#9a9890] text-xs drop-shadow-[0_1px_1px_rgba(255,255,255,0.9)] italic">Multiscan</span>
            </div>
            <div class="flex items-center gap-6 sm:gap-8">
              <div class="flex gap-4">
                <button class="w-8 h-2.5 bg-[#c4c2b9] rounded-sm shadow-[inset_-1px_-1px_3px_rgba(0,0,0,0.3),inset_1px_1px_3px_rgba(255,255,255,0.8),0_2px_4px_rgba(0,0,0,0.2)] active:shadow-[inset_1px_1px_3px_rgba(0,0,0,0.4),inset_-1px_-1px_3px_rgba(255,255,255,0.4)] transition-shadow"></button>
                <button class="w-8 h-2.5 bg-[#c4c2b9] rounded-sm shadow-[inset_-1px_-1px_3px_rgba(0,0,0,0.3),inset_1px_1px_3px_rgba(255,255,255,0.8),0_2px_4px_rgba(0,0,0,0.2)] active:shadow-[inset_1px_1px_3px_rgba(0,0,0,0.4),inset_-1px_-1px_3px_rgba(255,255,255,0.4)] transition-shadow"></button>
                <button class="w-8 h-2.5 bg-[#c4c2b9] rounded-sm shadow-[inset_-1px_-1px_3px_rgba(0,0,0,0.3),inset_1px_1px_3px_rgba(255,255,255,0.8),0_2px_4px_rgba(0,0,0,0.2)] active:shadow-[inset_1px_1px_3px_rgba(0,0,0,0.4),inset_-1px_-1px_3px_rgba(255,255,255,0.4)] transition-shadow"></button>
              </div>
              <div class="flex items-center gap-3">
                <div class="relative">
                  <div id="power-led" class="w-2.5 h-2.5 rounded-full bg-red-500 shadow-[0_0_8px_rgba(239,68,68,0.8),inset_0_1px_2px_rgba(255,255,255,0.8)] border border-red-700 transition-colors duration-300"></div>
                  <div id="power-led-glow" class="absolute -inset-1 bg-red-500/20 rounded-full blur-sm transition-colors duration-300"></div>
                </div>
                <button id="power-btn" class="w-10 h-8 bg-monitor-beige rounded-md shadow-[inset_-2px_-2px_5px_rgba(0,0,0,0.2),inset_2px_2px_5px_rgba(255,255,255,0.9),0_4px_6px_rgba(0,0,0,0.2)] flex items-center justify-center active:shadow-[inset_2px_2px_5px_rgba(0,0,0,0.3),inset_-2px_-2px_5px_rgba(255,255,255,0.4)] transition-all transform active:translate-y-[1px] cursor-pointer">
                  <iconify-icon icon="lucide:power" class="text-monitor-dark text-sm drop-shadow-[0_1px_0_rgba(255,255,255,0.9)]"></iconify-icon>
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Monitor Stand Neck -->
        <div class="relative z-10 w-40 h-20 bg-monitor-dark -mt-4 shadow-[inset_-15px_0_20px_rgba(0,0,0,0.3),inset_15px_0_20px_rgba(255,255,255,0.4)] flex flex-col items-center justify-end pb-3 border-x border-monitor-beige/50">
          <div class="w-20 h-0.5 bg-black/20 rounded-full mb-1.5 shadow-[0_1px_0_rgba(255,255,255,0.3)]"></div>
          <div class="w-20 h-0.5 bg-black/20 rounded-full mb-1.5 shadow-[0_1px_0_rgba(255,255,255,0.3)]"></div>
          <div class="w-20 h-0.5 bg-black/20 rounded-full shadow-[0_1px_0_rgba(255,255,255,0.3)]"></div>
        </div>

        <!-- Monitor Stand Base -->
        <div class="relative z-0 w-80 h-16 bg-monitor-beige rounded-t-[3rem] shadow-[inset_-5px_5px_15px_rgba(255,255,255,0.6),inset_5px_5px_15px_rgba(255,255,255,0.6),0_20px_40px_rgba(0,0,0,0.8)] border-t border-white flex items-end justify-center pb-2">
          <div class="w-56 h-3 bg-[#c4c2b9] rounded-full shadow-[inset_0_2px_5px_rgba(0,0,0,0.2),0_1px_0_rgba(255,255,255,0.8)]"></div>
        </div>
      </div>

      <!-- Power-on hint (visible only when off) -->
      <div id="power-hint" class="mt-6 text-center transition-opacity duration-500 opacity-100">
        <p class="text-2xl text-zinc-300 font-serif italic tracking-wide">Press the power button to turn on</p>
        <p class="text-xs text-zinc-500 font-sans tracking-[0.2em] uppercase mt-2">or press Enter to begin</p>
      </div>
    </main>
  </div>

  <!-- Error Toast -->
  <div id="error-toast" class="fixed bottom-8 left-1/2 -translate-x-1/2 z-50 bg-red-900/90 text-red-100 px-5 py-3 rounded-lg text-sm font-sans backdrop-blur-sm border border-red-700/50 opacity-0 pointer-events-none transition-opacity duration-300"></div>

  <script type="module" src="/src/main.ts"></script>
</body>
</html>
